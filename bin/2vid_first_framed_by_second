#!/bin/bash

CENTER_VID="$1"
FRAME_VID="$2"
OUTPUT_VID="$3"

if [[ -f "$CENTER_VID" && -f "$FRAME_VID" ]]; then
    echo "Processing: ${CENTER_VID} framed by ${FRAME_VID}"
else
    exit
fi

if [[ "" == "$OUTPUT_VID" ]]; then
    echo "Required output video filename,"
    exit
fi

ffmpeg \
  -i "$FRAME_VID" -i "$CENTER_VID"  -i "$FRAME_VID" \
  -filter_complex \
    "[0:v]hflip[flipped]; \
     [flipped][1:v][2:v]hstack=inputs=3[row]; \
     [0:a][1:a][2:a]amix=inputs=3[a]" \
  -map "[row]" -map "[a]" \
  -shortest \
  -c:v libx264 -preset fast -crf 23 \
  -pix_fmt yuv420p \
  -c:a aac -b:a 192k \
  "$OUTPUT_VID"
