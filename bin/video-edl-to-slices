#!/usr/bin/env ruby

edl = ARGV[0]

index = 0

File.readlines(edl).map {|line|
  unless line.include? "#"
    fields = line.split ","
    _ = fields.pop
    name = fields.shift
    start = fields.shift
    length = fields.shift
    count = "%04i" % index
    index += 1
    slice = "#{count}_#{name}"
    case [name, start, length]
        in [String, String, String]
           "ffmpeg -i #{name} -ss #{start} -t #{length} #{slice}"
        in [String, String, nil]
           "ffmpeg -i #{name} -ss #{start} #{slice}"
        in [String, nil, nil]
           "# ffmpeg -i #{name} #{slice}"
        in [nil, nil, nil]
           nil
    end
  end
}.compact.each { |l| puts l }
