#!/usr/bin/env bash

notify() {
    osascript -e "display notification \"$2\" with title \"$1\""
}
script_name=$(basename $0)
list_file="$1"
destination="$2"
prefix="${3-./}"

if [[ ! -e  "$list_file" || ! -d "$prefix" || ! -d "$destination" ]];then
   echo "Usage:

    $script_name <list_file> <destination_dir> [list_directory_prefix]
"
   exit 1
fi

total=$(wc -l "$list_file" | tr -d ' 	')

while read -r f
do
    file_pathname="${prefix}/${f}"
    line=$(grep -n "$file_pathname" "$list_file" | grep -E -o "^[0-9]+")
    if [[ -d "$file_pathname" ]]; then
        filename="$file_pathname"
        notify "Copying $line of $total " " $file_pathname"
        cp -rv "$file_pathname" "$destination"
    else
        filename="$(basename "$file_pathname")"
        notify "Copying $line of $total " " $filename"
        cp -v "$file_pathname" "$destination"
    fi
    notify "Copied $line of $total " " $filename"
    sleep 1
done < "$list_file"
